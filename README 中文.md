# RepDistiller

此代码库：

**（1）涵盖以下 ICLR 2020 论文的实现：**

“对比式表征蒸馏”（CRD）。[论文](http://arxiv.org/abs/1910.10699)，[项目页面](http://hobbitlong.github.io/CRD/)。

<div style="text-align:center"><img src="http://hobbitlong.github.io/CRD/CRD_files/teaser.jpg" width="85%" height="85%"></div>  

<p></p>

**（2）基准测试了 PyTorch 中 12 种最先进的知识蒸馏方法，包括：**

(KD) - 在神经网络中提炼知识  
(FitNet) - Fitnets：对薄深网的提示  
(AT) - 更多关注注意力：通过注意力转移提升卷积神经网络的性能  
(SP) - 保持相似性的知识蒸馏  
(CC) - 知识蒸馏的相关性一致  
(VID) - 用于知识转移的变分信息蒸馏  
(RKD) - 关系知识蒸馏  
(PKT) - 深度表征学习的概率性知识转移  
(AB) - 通过隐藏神经元形成的激活边界进行知识转移  
(FT) - 复杂网络释义：通过因子转移进行网络压缩  
(FSP) - 来自知识蒸馏的礼物：
    快速优化、网络最小化和迁移学习  
(NST) - 喜欢你喜欢的：通过神经元选择性转移进行知识蒸馏 

## 安装

此代码库已在 Ubuntu 16.04.5 LTS、Python 3.5、PyTorch 0.4.0 和 CUDA 9.0 上测试过。但它应该可以在 PyTorch 版本 >=0.4.0 的情况下运行。

## 运行

1. 通过以下方式获取预训练的教师模型：

    ```
    sh scripts/fetch_pretrained_teachers.sh
    ```
   这将下载并保存模型到 `save/models`
   
2. 按照 `scripts/run_cifar_distill.sh` 中的命令运行蒸馏。以下是运行 Geoffrey 原始的知识蒸馏（KD）的示例：

    ```
    python train_student.py --path_t ./save/models/resnet32x4_vanilla/ckpt_epoch_240.pth --distill kd --model_s resnet8x4 -r 0.1 -a 0.9 -b 0 --trial 1
    python train_student.py --path_t ./save/models/resnet32_CICIOV2024_lr_0.05_decay_0.0005_trial_0/resnet32_CICIOV2024_best.pth --distill kd --model_s resnet8x4 -r 0.1 -a 0.9 -b 0 --trial 1 --dataset CICIOV2024
    ```
    其中标志解释如下：
    - `--path_t`：指定教师模型的路径
    - `--model_s`：指定学生模型，查看 `models/__init__.py` 以检查可用的模型类型。
    - `--distill`：指定蒸馏方法
    - `-r`：对数值和真实值之间交叉熵损失的权重，默认值：`1`
    - `-a`：KD 损失的权重，默认值：`None`
    - `-b`：其他蒸馏损失的权重，默认值：`None`
    - `--trial`：指定实验 ID 以区分多次运行。
    
    因此，运行 CRD 的命令类似于：
    ```
    python train_student.py --path_t ./save/models/resnet32x4_vanilla/ckpt_epoch_240.pth --distill crd --model_s resnet8x4 -a 0 -b 0.8 --trial 1 
    ```
    
3. 将蒸馏目标与 KD 结合起来，只需将 `-a` 设置为非零值，这将导致以下示例（将 CRD 与 KD 结合）：
    ```
    python train_student.py --path_t ./save/models/resnet32x4_vanilla/ckpt_epoch_240.pth --distill crd --model_s resnet8x4 -a 1 -b 0.8 --trial 1     
    ```

4. （可选）从头开始训练教师网络。示例命令在 `scripts/run_cifar_vanilla.sh` 中

注意：默认设置适用于单 GPU 训练。如果您想在多 GPU 上运行此代码库，您可能需要调整学习率，经验上需要根据批量大小线性地放大，参见[这篇论文](https://arxiv.org/abs/1706.02677)

## CIFAR-100 上的基准结果：

性能以分类准确率（%）测量

1. 教师和学生的**相同**架构类型。

| 教师 <br> 学生 | wrn-40-2 <br> wrn-16-2 | wrn-40-2 <br> wrn-40-1 | resnet56 <br> resnet20 | resnet110 <br> resnet20 | resnet110 <br> resnet32 | resnet32x4 <br> resnet8x4 |  vgg13 <br> vgg8 |
|:---------------:|:-----------------:|:-----------------:|:-----------------:|:------------------:|:------------------:|:--------------------:|:-----------:|
| 教师 <br> 学生 |    75.61 <br> 73.26    |    75.61 <br> 71.98    |    72.34 <br> 69.06    |     74.31 <br> 69.06    |     74.31 <br> 71.14    |      79.42 <br> 72.50     | 74.64 <br> 70.36 |
| KD | 74.92 | 73.54 | 70.66 | 70.67 | 73.08 | 73.33 | 72.98 |
| FitNet | 73.58 | 72.24 | 69.21 | 68.99 | 71.06 | 73.50 | 71.02 |
| AT | 74.08 | 72.77 | 70.55 | 70.22 | 72.31 | 73.44 | 71.43 |
| SP | 73.83 | 72.43 | 69.67 | 70.04 | 72.69 | 72.94 | 72.68 |
| CC | 73.56 | 72.21 | 69.63 | 69.48 | 71.48 | 72.97 | 70.71 |
| VID | 74.11 | 73.30 | 70.38 | 70.16 | 72.61 | 73.09 | 71.23 |
| RKD | 73.35 | 72.22 | 69.61 | 69.25 | 71.82 | 71.90 | 71.48 |
| PKT | 74.54 | 73.45 | 70.34 | 70.25 | 72.61 | 73.64 | 72.88 |
| AB | 72.50 | 72.38 | 69.47 | 69.53 | 70.98 | 73.17 | 70.94 |
| FT | 73.25 | 71.59 | 69.84 | 70.22 | 72.37 | 72.86 | 70.58 |
| FSP | 72.91 | 不适用 | 69.95 | 70.11 | 71.89 | 72.62 | 70.23 |
| NST | 73.68 | 72.24 | 69.60 | 69.53 | 71.96 | 73.30 | 71.53 |
| **CRD** | **75.48** | **74.14** | **71.16** | **71.46** | **73.48** | **75.51** | **73.94** |

2. 教师和学生的**不同**架构类型。

| 教师 <br> 学生 | vgg13 <br> MobileNetV2 | ResNet50 <br> MobileNetV2 | ResNet50 <br> vgg8 | resnet32x4 <br> ShuffleNetV1 | resnet32x4 <br> ShuffleNetV2 | wrn-40-2 <br> ShuffleNetV1 |
|:---------------:|:-----------------:|:--------------------:|:-------------:|:-----------------------:|:-----------------------:|:---------------------:|
| 教师 <br> 学生 |    74.64 <br> 64.60    |      79.34 <br> 64.60     |  79.34 <br> 70.36  |       79.42 <br> 70.50       |       79.42 <br> 71.82       |      75.61 <br> 70.50      |
| KD | 67.37 | 67.35 | 73.81 | 74.07 | 74.45 | 74.83 |
| FitNet | 64.14 | 63.16 | 70.69 | 73.59 | 73.54 | 73.73 |
| AT | 59.40 | 58.58 | 71.84 | 71.73 | 72.73 | 73.32 |
| SP | 66.30 | 68.08 | 73.34 | 73.48 | 74.56 | 74.52 |
| CC | 64.86 | 65.43 | 70.25 | 71.14 | 71.29 | 71.38 |
| VID | 65.56 | 67.57 | 70.30 | 73.38 | 73.40 | 73.61 |
| RKD | 64.52 | 64.43 | 71.50 | 72.28 | 73.21 | 72.21 |
| PKT | 67.13 | 66.52 | 73.01 | 74.10 | 74.69 | 73.89 |
| AB | 66.06 | 67.20 | 70.65 | 73.55 | 74.31 | 73.34 |
| FT | 61.78 | 60.99 | 70.29 | 71.75 | 72.50 | 72.03 |
| NST | 58.16 | 64.96 | 71.28 | 74.12 | 74.68 | 74.89 |
| **CRD** | **69.73** | **69.11** | **74.30** | **75.11** | **75.65** | **76.05** |

## 引用

如果您觉得这个代码库对您的研究有帮助，请考虑引用该论文

